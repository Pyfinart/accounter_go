# 📈 时间段统计功能

## 功能概述

为记账系统添加了强大的时间段统计功能，支持按月、按年、按周进行财务数据分析。

## 🚀 新功能特性

### 1. 多维度时间段统计
- **按月统计**: 查看每月收支情况
- **按年统计**: 查看年度财务总结
- **按周统计**: 查看每周收支趋势

### 2. 丰富的统计信息
- 每个时间段的收入、支出、余额
- 交易笔数统计
- 可视化图表展示
- 详细的时间段列表

### 3. 灵活的筛选功能
- 支持按年份筛选
- 支持按月份筛选（按月统计时）
- 支持按周数筛选（按周统计时）

## 🔧 API接口

### 时间段统计接口
```
GET /api/period-stats
```

#### 请求参数
- `period_type`: 统计类型 (1=按月, 2=按年, 3=按周)
- `year`: 年份 (如 2025)
- `month`: 月份 (1-12, 仅用于按月统计)
- `week`: 周数 (1-53, 仅用于按周统计)

#### 响应示例
```json
{
  "periods": [
    {
      "periodName": "2025年6月",
      "income": 550,
      "expense": 10965.55,
      "balance": -10415.55,
      "transactionCount": 114
    }
  ],
  "totalIncome": 550,
  "totalExpense": 15420.1,
  "totalBalance": -14870.1
}
```

## 🎨 前端界面

### 新增UI组件
1. **时间段统计卡片**: 显示期间总收入、总支出、总余额
2. **统计类型选择器**: 支持按月/按年/按周切换
3. **年份选择器**: 动态显示当前年份和未来几年
4. **月份/周数选择器**: 根据统计类型动态显示
5. **柱状图表**: 可视化展示时间段收支对比
6. **时间段列表**: 详细显示每个时间段的统计数据

### 交互功能
- 实时数据更新
- 动态图表重绘
- 响应式设计
- 移动端友好

## 🧪 测试验证

### 测试脚本
```bash
./test_period_stats.sh
```

### 测试结果
- ✅ 按月统计功能正常
- ✅ 按年统计功能正常  
- ✅ 按周统计功能正常
- ✅ API接口响应正确
- ✅ 数据计算准确

## 📊 使用示例

### 1. 按月统计 (2025年)
```bash
curl "http://localhost:8000/api/period-stats?period_type=1&year=2025"
```

### 2. 按年统计
```bash
curl "http://localhost:8000/api/period-stats?period_type=2&year=2025"
```

### 3. 按周统计 (2025年第25周)
```bash
curl "http://localhost:8000/api/period-stats?period_type=3&year=2025&week=25"
```

## 🔄 数据更新

时间段统计数据会实时更新：
- 添加新交易记录时自动更新
- 删除交易记录时自动更新
- 修改交易记录时自动更新

## 🎯 技术实现

### 后端实现
- **Proto定义**: 新增 `PeriodStatsRequest` 和 `PeriodStatsReply`
- **业务逻辑**: 在 `biz` 层添加时间段统计逻辑
- **数据层**: 在 `data` 层实现时间段分组统计
- **服务层**: 在 `service` 层提供API接口

### 前端实现
- **UI组件**: 新增时间段统计界面
- **JavaScript**: 实现数据获取和图表展示
- **CSS样式**: 响应式设计和美观界面

## 🚀 部署说明

1. 重新生成proto文件：
```bash
make api
```

2. 重新编译项目：
```bash
go build -o build/accounter ./cmd/accounter
```

3. 启动服务：
```bash
./start.sh
```

4. 访问Web界面：
```
http://localhost:3000
```

## 📈 未来扩展

- [ ] 支持按季度统计
- [ ] 支持自定义时间段
- [ ] 支持数据导出功能
- [ ] 支持更多图表类型
- [ ] 支持数据对比功能 